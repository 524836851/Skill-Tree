

## 网络模型
基础七层模型
（应用层 表示层 会话层）传输层 网络层 链路层 物理层
本质就是定义一些协议 ，不断包裹一些数据头
对于每一层来说都是 这一层协议相关的数据头+数据体（不关心）

### 链路层
MTU 最大网络传输单元
对应物理线路环境下最小不分割能传输的包的大小，1500

MTU越大 传输效率越高

### 网络层

网关的意义：
* 解决公共IP数量有限的问题
* 进行一些防火墙等安全操作
因此本质网关就是实现一个网络代理的过程，因此它是在一个网络层上实现的功能（即IP层上实现的）。通过不断的替换目标IP 或者 源IP

VPN
链路层、或者网络层 根据具体的实现来
为什么容易被封？？

SS代理
是在应用层上实现的一个协议
可以看做四层代理吗？
http代理怎么实现的？

1、了解IP报文头的一些格式

传输层包大小超过MTU？拆包 ，因此头部字段一些就是与这些拆包相关的。
引出缓存问题、乱序、丢弃问题

IP的缓存（系统实现了好，这里字段的设计大小）

**2、 实战**
* tcpdump工具 抓包
实现tcpdump工具

### 传输层
TCP、UPD协议
报文字段含义掌握

三次握手、四次挥手、具体每个状态（状态机，以及状态机之间的转移）的含义，能够看懂具体报文的消息
TimeWait 存在的时间是为了等待客户端还在路上的包，避免该端口被重用，发给新的连接

因为TCP协议复杂(为了是可靠的），因此有很多可以攻击的点。如DDos攻击
内核中半连接、全连接队列？是Listen的监听队列吗？（参考博客)[https://www.cnblogs.com/xiaolincoding/p/12995358.html]


TCP、UDP 大包传输问题
切片？粘包问题？

粘包 及时断开连接？
只要流没问题，就不应该断开连接？

UDP这一层不分片，由IP层切片
能发多大的包？大小是由协议层定义的两字节
但是大包因为IP层切多片 就容易产生丢包问题（如果需要可靠 则需要应用层来解决这个问题，即UDP传输层的上面一层）

### 套接字

socket options的使用
常用的网络函数

REUSEPORT 使得多个进程同时监听同个端口

### 网络并发相关

* 阻塞和非阻塞
* 同步和异步
同步异步概念
就是完成多项任务的时候的顺序
同步：任务一项接一项的完成
异步：任务之间交叉进行（所以异步只是一种概念，并行本质上也是一种异步执行）
（每个任务中都有可能会调用多个接口，因此如果接口时阻塞的，那就必须时同步执行，如果接口是非阻塞的，那就有可能实现异步执行）
* 如何用非阻塞接口实现同步逻辑 （死循环访问接口）

那用阻塞接口能实现异步执行吗，我觉得通过并行的方式就是。

总结一下，网络并发相关的就是希望能够同时处理越多的连接越好，那么如何实现呢
多进程、多线程（那具体的接口可以直接使用阻塞的）
更常用的方式：单线程异步（如何实现？多路复用（相当于一个事件注册触发管理机制）+异步接口调用（即将Socket要设置为非阻塞的fcntl函数，否则在处理过程中就会浪费时间在等待接口上）

* 多路复用
边缘触发、水平触发掌握
* 将Socket设置为非阻塞


* 异步实现的方法
1、多路复用。 （代码实现复杂，相当于本质手动管理上下文切换，这里上下文是指一个连接处理所需要的上下文连接）
2、多线程同步 （线程进程资源有限，有切换成本）
不高效的原因在于两点1、调度有系统调度，并不一定能刚好调度到需要执行的线程上 2、线程有切换成本

3、协程？ （同步方式编码、异步执行）（相当于本质实现了上下文切换，这里切换是在用户态切换，因此相比线程更轻量，因此切换成本低，同时它的调度本质也是劫持协程中的IO事件，然后调度到其他的协程执行，因此协程可以说是结合了上述两者的优点、编码简单，同时还高效）

* 网络框架
1、 主进程监听，多个子进程（线程)**同步处理**（意味着没有多路复用）
这里需要使用进程池
实际例子：apache、memcache
2、单进程异步：
感觉Reactor就是类似的模式
实际例子 Redis
3、多进程异步 这个也像是Reactor模式
实际例子：Nginx

异步：
Buffer如何处理（当内核Buffer不用的时候）
每个fd申请一个buffer？（不可能，因为10w个用户就爆） （RPC框架是如何解决这个问题的？）

异常情况处理：
1、信号量打断？
2、非阻塞IO
3、管道破裂（往关闭的文件描述符中写入数据）

time_wait很多怎么处理？
负载均衡怎么做？？